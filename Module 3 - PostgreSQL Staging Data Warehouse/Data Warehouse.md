# PostgreSQL Staging Data Warehouse
> Sales data from MySQL and catalog data from MongoDB will be periodically extracted and stored into a staging data warehouse running on PostgreSQL. The data will then be transformed and loaded into a production data warehouse running on IBM Db2 to generate reports such as:
>- total sales per year per country
>- total sales per month per category
>- total sales per quarter per country
>- total sales per category per country
>- Design a data warehouse star schema using the pgAdmin ERD design tool, ensuring the table can generate yearly, monthly, daily, and weekly reports. Export the schema SQL and create a staging database. Your Senior Data Engineer will then review your schema design. Make any necessary adjustments before moving to the next phase.

# Data Warehouse Schema
![sample_order_data](https://github.com/rupamdusane/IBM-Data_Engineering_Capstone_Project/assets/92736419/c4ab6fa8-a359-4e49-a179-374a1e5ed3eb)

Based on the sample order data and report requirements, the fact of measure will be constructed in the following table:

- `softcartFactSales`
orderid PRIMARY KEY
dateid FOREIGN KEY
categoryid FOREIGN KEY
countryid FOREIGN KEY
itemid FOREIGN KEY
amount
and will contain the following dimensions:

- `softcartDimDate`
  - dateid PRIMARY KEY
  - date
  - Year
  - Quarter
  - QuarterName
  - Month
  - MonthName
  - Day
  - Weekday
  - WeekdayName
- `softcartDimCategory`
  - categoryid PRIMARY KEY
  - category
- `softcartDimCountry`
  - countryid PRIMARY KEY
  - country
- `softcartDimItem`
  - itemid PRIMARY KEY
  - item
# 1. pgAdmin ERD Star Schema Design
Will start now by creating a temporary database softcart to design the star schema using pgAdmin's ERD Design Tool. Next, I will create tables for each dimension/fact and design the relationships between them.

![softcartRelationships](https://github.com/rupamdusane/IBM-Data_Engineering_Capstone_Project/assets/92736419/9ac6d27c-e800-4ca0-be48-84ce0ca9801c)


# 2. Export Schema
With the star schema designed, I can now export it as SQL and create our staging database.
```ruby
-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE public."DimCategory"
(
    categoryid smallint NOT NULL,
    category character varying(32)[] NOT NULL,
    PRIMARY KEY (categoryid)
);

CREATE TABLE public."DimCountry"
(
    countryid smallint NOT NULL,
    country character varying(32)[] NOT NULL,
    PRIMARY KEY (countryid)
);

CREATE TABLE public."DimDate"
(
    dateid smallint NOT NULL,
    date date NOT NULL,
    "Year" smallint NOT NULL,
    "Quarter" smallint NOT NULL,
    "QuarterName" character varying(2)[] NOT NULL,
    "Month" smallint NOT NULL,
    "Monthname" character varying(9)[] NOT NULL,
    "Day" smallint NOT NULL,
    "Weekday" smallint NOT NULL,
    "WeekdayName" character varying(9)[] NOT NULL,
    PRIMARY KEY (dateid)
);

CREATE TABLE public."FactSales"
(
    orderid bigint NOT NULL,
    dateid smallint NOT NULL,
    countryid smallint NOT NULL,
    categoryid smallint NOT NULL,
    amount bigint NOT NULL,
    PRIMARY KEY (orderid)
);

ALTER TABLE public."FactSales"
    ADD FOREIGN KEY (dateid)
    REFERENCES public."DimDate" (dateid)
    NOT VALID;


ALTER TABLE public."FactSales"
    ADD FOREIGN KEY (countryid)
    REFERENCES public."DimCountry" (countryid)
    NOT VALID;


ALTER TABLE public."FactSales"
    ADD FOREIGN KEY (categoryid)
    REFERENCES public."DimCategory" (categoryid)
    NOT VALID;

END;
```
> COMMIT
> Query returned successfully in 781 msec.

![createschema](https://github.com/rupamdusane/IBM-Data_Engineering_Capstone_Project/assets/92736419/47d47e00-d448-4de5-a83b-7cdeeaefad1d)


# About This Lab
Environment/IDE
This portion of the project will be using the Cloud IDE based on Theia and PostgreSQL database running in a Docker container.

# Tools/Software
- ERD Design Tool of pgAdmin
- PostgreSQL Database Server
